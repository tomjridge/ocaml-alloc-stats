# ocaml-alloc-stats

This repo supports analysis of allocation traces produced by memtrace. The main file is `main.ipynb`, a jupyter notebook that loads an allocation trace from a `.ctf ` file, draws some histograms, and computes some statistics. There should be documentation in the jupyter notebook itself.

## Background

* statmemprof statistical memory profiling was introduced in OCaml 4.11. The blog post https://blog.janestreet.com/finding-memory-leaks-with-memtrace/ discusses using it to profile code.
* memtrace is "a streaming client for OCaml's Memprof" which can log (stat)memprof data to file. See https://github.com/janestreet/memtrace . By inserting a single line in a target program, and setting an environment variable `MEMTRACE` to a filename, memprof data will be written to the corresponding file in common trace format (ctf). The envvar `MEMTRACE_RATE` controls the sampling rate. This can be 1.0 to record all allocs, or e.g. 0.001 to record a small fraction of the allocs. Long running programs can produce many GBs of trace data (so this variable should be set low), whereas short-running programs can afford to set this variable to 1.0 and record all allocs. It is important to be aware, when looking at a trace, what the sampling rate was when the trace was recorded.
* 



## Some files in this repo





## Notes on the provenance of some of the files:

* irmin-mem: 
  - irmin-mem.ctf: generated by using memtrace/statmemprof when running irmin in-mem
    tests, with MEMTRACE_TRACE=0.001
  - irmin-mem.ctf.dump: generated by dump.exe in ocaml-gc-events-tracing; this is an
    easy-to-read format for the ctf, such that the data can be easily munged using
    Python. Python also includes support for reading ctf files directly
